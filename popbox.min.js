(function(){$.fn.popbox=function(t){return this.each(function(){function o(){e.left=s.width()/2-10,i.left=s.width()/2-10,"top"===n.placement?(e["border-top-style"]="solid",e["border-top-width"]="11px",e.top=s.height()-1,i["border-top-style"]="solid",i["border-top-width"]="11px",i.top=s.height()+1):(e["border-bottom-style"]="solid",e["border-bottom-width"]="11px",e.top="-10px",i["border-bottom-style"]="solid",i["border-bottom-width"]="11px",i.top="-12px"),r.find(n.arrow).css(e),r.find(n.arrow_border).css(i)}var e,i,n=$.extend({open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close",collapse:".collapse",dynamic_width:!1,placement:"bottom"},t),s=$(this).find(n.box),r=$(this),d={open:function(t){t.preventDefault()
var e,i,r=$(this),l=r.parent(),p=(s.width()-l.width())/2,h=l.offset().left,c=$(window).width()-h-l.outerWidth()
i="top"===n.placement?-1*s.height()-$(this).height()-8:10,e={display:"block",top:i},"block"==s.css("display")?d.close():(p>h?e.left=0>h?0:-h:p>c?e.right=0>c?0:-c:e.left=-p,s.css(e),o())},close:function(){s.fadeOut("fast")}}
$(document).bind("keyup",function(t){27==t.keyCode&&d.close()}),$(document).bind("click",function(t){r.has($(t.target)).length||d.close()}),$(this).find(n.collapse).css({position:"relative"}),$(this).find(n.box).css({display:"none",position:"absolute"}),e={width:"0",height:"0","border-left":"11px solid transparent","border-right":"11px solid transparent",position:"absolute","z-index":"1001"},i={width:"0",height:"0","border-left":"11px solid transparent","border-right":"11px solid transparent",position:"absolute","z-index":"1000"},n.dynamic_width&&$(this).css({width:s.width()}),$(n.open,this).bind("click",d.open),$(n.open,this).parent().find(n.close).bind("click",function(t){t.preventDefault(),d.close()})})}}).call(this)
