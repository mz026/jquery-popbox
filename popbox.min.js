(function(){$.fn.popbox=function(t){return this.each(function(){function o(){e.left=r.width()/2-10,i.left=r.width()/2-10,"top"===n.placement?(e["border-top-style"]="solid",e["border-top-width"]="11px",e.top=r.height()-1,i["border-top-style"]="solid",i["border-top-width"]="11px",i.top=r.height()+1):(e["border-bottom-style"]="solid",e["border-bottom-width"]="11px",e.top="-10px",i["border-bottom-style"]="solid",i["border-bottom-width"]="11px",i.top="-12px"),s.find(n.arrow).css(e),s.find(n.arrow_border).css(i)}var e,i,n=$.extend({open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close",dynamic_width:!1,placement:"bottom"},t),r=$(this).find(n.box),s=$(this),d={open:function(t){t.preventDefault();var e,i,s=$(this),l=s.parent(),p=(r.width()-l.width())/2,h=l.offset().left,c=$(window).width()-h-l.outerWidth();i="top"===n.placement?-1*r.height()-$(this).height()-8:10,e={display:"block",top:i},"block"==r.css("display")?d.close():(p>h?e.left=0>h?0:-h:p>c?e.right=0>c?0:-c:e.left=-p,r.css(e),o())},close:function(){r.fadeOut("fast")}};$(document).bind("keyup",function(t){27==t.keyCode&&d.close()}),$(document).bind("click",function(t){s.has($(t.target)).length||d.close()}),$(this).find(".collapse").css({position:"relative"}),$(this).find(n.box).css({display:"none",position:"absolute"}),e={width:"0",height:"0","border-left":"11px solid transparent","border-right":"11px solid transparent",position:"absolute","z-index":"1001"},i={width:"0",height:"0","border-left":"11px solid transparent","border-right":"11px solid transparent",position:"absolute","z-index":"1000"},n.dynamic_width&&$(this).css({width:r.width()}),$(n.open,this).bind("click",d.open),$(n.open,this).parent().find(n.close).bind("click",function(t){t.preventDefault(),d.close()})})}}).call(this);